
CFLAGS += -g -Wall -O2 -I ../leveldb/include -fPIC

%.o: %.c
	$(OCAMLC) -cc g++ $(mapprefix -ccopt, $(CFLAGS)) -c $^

leveldb_stubs.o: leveldb_stubs.cc

leveldb.cma leveldb.a leveldb.cmxa: leveldb_stubs.o levelDB.cmx levelDB.cmo ../leveldb/libleveldb.a
	ocamlmklib -verbose -oc camlleveldb -o leveldb -L../leveldb -lleveldb -lsnappy $^

.DEFAULT: leveldb.cma leveldb.cmxa

.PHONY: clean

clean:
	rm -f $(filter-proper-targets $(ls R, .)) *.s *.annot *.so *.a
